<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>Fiche Patient - Algorithme Lithiase KALONJI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="/static/css/myoneart.css">
</head>
<body class="page-bg">
    <nav class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-6 flex justify-between items-center">
            <h1 class="text-3xl font-bold">üíé KALONJI</h1>
            <div class="flex items-center space-x-6">
                <a href="/" class="hover:text-indigo-200 transition-colors font-medium">üè† Tableau de bord</a>
                <a href="/nouveau-patient" class="hover:text-indigo-200 transition-colors font-medium">‚ûï Nouveau Patient</a>
                <a href="/search" class="hover:text-indigo-200 transition-colors font-medium">üîç Recherche</a>
                <a href="/parametres" class="hover:text-indigo-200 transition-colors font-medium">‚öôÔ∏è Param√®tres</a>
                <a href="/logout" class="hover:text-indigo-200 transition-colors font-medium">üö™ D√©connexion</a>
            </div>
        </div>
    </nav>
    
    <div class="container mx-auto p-6">
        <div class="card mb-6">
            <div class="flex justify-between items-center mb-6">
                <div class="w-full">
                    <div class="flex justify-between items-center mb-4">
                        <h2 id="patientName" class="text-3xl font-bold text-gray-800"></h2>
                        <div class="flex gap-3">
                            <button onclick="showEditPatientModal()" class="btn btn-primary py-3 px-6">
                                ‚úèÔ∏è Modifier
                            </button>
                            <button onclick="showDeleteConfirmModal()" class="btn bg-red-600 hover:bg-red-700 text-white py-3 px-6 transition-colors">
                                üóëÔ∏è Supprimer
                            </button>
                            <button onclick="exportPDF()" class="btn btn-success py-3 px-6">
                                üìÑ Exporter PDF
                            </button>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-indigo-100 to-purple-100 border-2 border-indigo-300 rounded-lg p-6 mb-6">
                        <h3 class="text-xl font-bold text-indigo-900 mb-3 flex items-center">
                            <span class="text-2xl mr-2">üéØ</span> Objectifs de l'analyse
                        </h3>
                        <ul class="space-y-2 text-sm text-gray-800">
                            <li class="flex items-start">
                                <span class="text-indigo-600 mr-2">‚úì</span>
                                <span>D√©terminer la <strong>nature morpho-constitutionnelle</strong> du calcul selon la classification de Daudon</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-indigo-600 mr-2">‚úì</span>
                                <span>D√©tecter les <strong>anomalies dans les habitudes</strong> du patient favorisant la formation des calculs</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-indigo-600 mr-2">‚úì</span>
                                <span>Proposer un <strong>r√©gime alimentaire adapt√©</strong> pour pr√©venir les r√©cidives</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-indigo-600 mr-2">‚úì</span>
                                <span>Recommander un <strong>traitement m√©dical</strong> fond√© sur les derni√®res donn√©es scientifiques</span>
                            </li>
                            <li class="flex items-start">
                                <span class="text-indigo-600 mr-2">‚úì</span>
                                <span>En cas d'infection urinaire associ√©e : proposer un traitement adapt√© selon la <strong>nature du germe</strong> isol√©</span>
                            </li>
                        </ul>
                    </div>
                    
                    <div class="space-y-6">
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-3">üìã Informations personnelles</h3>
                            <div id="patientInfo" class="grid grid-cols-2 gap-3 text-gray-700"></div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-3">üè• Ant√©c√©dents m√©dicaux</h3>
                            <div id="patientMedicalHistory" class="grid grid-cols-1 gap-3 text-gray-700"></div>
                        </div>
                        
                        <div>
                            <h3 class="text-xl font-bold text-gray-800 mb-3">üíß Facteurs de risque & Hygi√®ne de vie</h3>
                            <div id="patientRiskFactors" class="grid grid-cols-2 gap-3 text-gray-700"></div>
                        </div>
                        
                        <div id="patientNotesSection" class="hidden">
                            <h3 class="text-xl font-bold text-gray-800 mb-3">üìù Notes</h3>
                            <div id="patientNotes" class="p-4 bg-gray-50 rounded-lg text-gray-700"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="card mb-6">
            <div class="flex justify-between items-center mb-6">
                <div>
                    <h3 class="text-2xl font-bold text-gray-800">üìä √âpisodes</h3>
                    <p class="text-gray-600 mt-1">Historique des √©pisodes lithiasiques</p>
                </div>
                <button onclick="showNewEpisodeModal()" class="btn btn-primary py-2 px-4">
                    ‚ûï Nouvel √âpisode
                </button>
            </div>
            <div id="episodesList" class="space-y-4"></div>
        </div>
    </div>
    
    <div id="newEpisodeModal" class="hidden modal-backdrop">
        <div class="modal-content modal-md my-8 mx-4">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-2xl font-bold text-gray-800">‚ûï Nouvel √âpisode</h3>
            </div>
            <div class="p-6 max-h-[70vh] overflow-y-auto">
                <form id="newEpisodeForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üìÖ Date *</label>
                            <input type="date" name="date_episode" required class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">üìù Motif</label>
                            <input type="text" name="motif" class="input-field">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">ü©∫ Diagnostic</label>
                        <input type="text" name="diagnostic" class="input-field">
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <div class="flex items-center">
                            <input type="checkbox" name="douleur" id="douleur" class="mr-2">
                            <label for="douleur">üò£ Douleur</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" name="fievre" id="fievre" class="mr-2">
                            <label for="fievre">üå°Ô∏è Fi√®vre</label>
                        </div>
                        <div class="flex items-center">
                            <input type="checkbox" name="infection_urinaire" id="infection" class="mr-2">
                            <label for="infection">ü¶† Infection urinaire</label>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="hideNewEpisodeModal()" class="btn btn-secondary">Annuler</button>
                        <button type="submit" class="btn btn-primary">Cr√©er</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div id="episodeDetailModal" class="hidden modal-backdrop">
        <div class="modal-content modal-lg my-8 mx-4">
            <div class="p-6 border-b border-gray-200 flex justify-between items-center">
                <h3 class="text-2xl font-bold text-gray-800">üìã D√©tails de l'√©pisode</h3>
                <button onclick="hideEpisodeDetailModal()" class="btn btn-secondary btn-close">‚úï</button>
            </div>
            <div class="p-6 max-h-[80vh] overflow-y-auto">
                <div class="grid grid-cols-1 gap-6">
                    <div>
                        <h4 class="text-xl font-bold text-gray-800 mb-4">üî¨ Imagerie</h4>
                        <button onclick="showNewImagingModal()" class="btn btn-primary mb-4">‚ûï Ajouter Imagerie</button>
                        <div id="imagingList" class="space-y-3"></div>
                    </div>
                    
                    <div>
                        <h4 class="text-xl font-bold text-gray-800 mb-4">üß™ Biologie</h4>
                        <button onclick="showNewBiologyModal()" class="btn btn-primary mb-4">‚ûï Ajouter Biologie</button>
                        <div id="biologyList" class="space-y-3"></div>
                    </div>
                </div>
                
                <div class="mt-6 pt-6 border-t border-gray-200">
                    <div class="mb-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
                        <h5 class="font-bold text-blue-900 mb-2">‚ÑπÔ∏è √Ä propos de l'algorithme d'inf√©rence</h5>
                        <p class="text-sm text-blue-800 mb-2">L'algorithme utilise un syst√®me de notation sur 20 points bas√© sur :</p>
                        <ul class="text-sm text-blue-800 list-disc list-inside space-y-1">
                            <li><strong>Densit√© scanner (max 6 pts)</strong> : Plage typique pour chaque type de calcul</li>
                            <li><strong>Morphologie (max 3 pts)</strong> : Forme caract√©ristique ou compatible</li>
                            <li><strong>pH urinaire (max 3 pts)</strong> : Plage pr√©f√©rentielle selon le type</li>
                            <li><strong>Marqueurs m√©taboliques (max 4 pts)</strong> : Hyperoxalurie, hypercalciurie, etc.</li>
                            <li><strong>Infection urinaire (max 3 pts)</strong> : Favorable ou d√©favorable selon le type</li>
                            <li><strong>Radio-opacit√© (max 1 pt)</strong> : Opaque ou transparent</li>
                        </ul>
                        <p class="text-sm text-blue-800 mt-2">Le type de calcul avec le score le plus √©lev√© est propos√©, avec indication si le diagnostic est incertain.</p>
                    </div>
                    <button onclick="runInference()" class="btn btn-purple py-3 px-6 text-base">
                        ü§ñ Calculer le type de calcul
                    </button>
                    <div id="inferenceResult" class="mt-4"></div>
                </div>
            </div>
        </div>
    </div>
    
    <div id="newImagingModal" class="hidden modal-backdrop">
        <div class="modal-content modal-lg my-8 mx-4">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">üî¨ Nouvelle Imagerie</h3>
            </div>
            <div class="p-6 max-h-[70vh] overflow-y-auto">
                <form id="newImagingForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">üìÖ Date examen *</label>
                            <input type="date" name="date_examen" required class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">üî¢ Nombre de calculs</label>
                            <input type="number" name="nombre_calculs" min="0" class="input-field">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">üìã R√©sultats ASP (Abdomen Sans Pr√©paration)</label>
                        <textarea name="asp_resultats" rows="2" class="input-field" placeholder="R√©sultats de la radiographie..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">üîä R√©sultats √âchographie</label>
                        <textarea name="echographie_resultats" rows="2" class="input-field" placeholder="R√©sultats de l'√©chographie..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">üíª R√©sultats Uro-scanner</label>
                        <textarea name="uroscanner_resultats" rows="2" class="input-field" placeholder="R√©sultats de l'uro-scanner..."></textarea>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">üìç Topographie du calcul</label>
                            <input type="text" name="topographie_calcul" list="topographie_suggestions" placeholder="Ex: Rein droit, calice inf√©rieur" class="input-field">
                            <datalist id="topographie_suggestions">
                                <option value="Rein droit">
                                <option value="Rein gauche">
                                <option value="Calice inf√©rieur droit">
                                <option value="Calice inf√©rieur gauche">
                                <option value="Calice moyen droit">
                                <option value="Calice moyen gauche">
                                <option value="Calice sup√©rieur droit">
                                <option value="Calice sup√©rieur gauche">
                                <option value="Bassinet droit">
                                <option value="Bassinet gauche">
                                <option value="Uret√®re droit">
                                <option value="Uret√®re gauche">
                                <option value="Uret√®re pelvien droit">
                                <option value="Uret√®re pelvien gauche">
                                <option value="Vessie">
                                <option value="Ur√®tre">
                                <option value="Bilat√©rale">
                            </datalist>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">üìç Localisation</label>
                            <input type="text" name="localisation" placeholder="Ex: Uret√®re pelvien" class="input-field">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-3 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">üìè Diam√®tre longitudinal (mm)</label>
                            <input type="number" step="0.1" name="diametre_longitudinal" class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">üìê Diam√®tre transversal (mm)</label>
                            <input type="number" step="0.1" name="diametre_transversal" class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">üìè Taille (mm)</label>
                            <input type="number" name="taille_mm" min="0" class="input-field">
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">üî∂ Forme du calcul</label>
                            <select name="forme_calcul" class="input-field">
                                <option value="">-- S√©lectionner --</option>
                                <option value="Arrondie">Arrondie</option>
                                <option value="Ovale">Ovale</option>
                                <option value="Irreguliere">Irr√©guli√®re</option>
                                <option value="Coralliforme">Coralliforme</option>
                                <option value="Spiculee">Spicul√©e</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">‚≠ï Contour du calcul</label>
                            <select name="contour_calcul" class="input-field">
                                <option value="">-- S√©lectionner --</option>
                                <option value="Lisse">Lisse</option>
                                <option value="Irregulier">Irr√©gulier</option>
                                <option value="Spicule">Spicul√©</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">‚ö° Densit√© (UH)</label>
                            <input type="number" name="densite_uh" min="100" max="2200" class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">üíé Densit√© du noyau (UH)</label>
                            <input type="number" name="densite_noyau" class="input-field">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">üåà Densit√©s des diff√©rentes couches</label>
                        <input type="text" name="densites_couches" placeholder="Ex: Couche 1: 800 UH, couche 2: 650 UH..." class="input-field">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">üîç Morphologie</label>
                            <select name="morphologie" class="input-field">
                                <option value="">-- S√©lectionner --</option>
                                <option value="spherique_lisse">Sph√©rique lisse</option>
                                <option value="irreguliere_spiculee">Irr√©guli√®re spicul√©e</option>
                                <option value="crayeuse">Crayeuse</option>
                                <option value="coralliforme">Coralliforme</option>
                                <option value="heterogene">H√©t√©rog√®ne</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">üì° Radio-opacit√©</label>
                            <select name="radio_opacite" class="input-field">
                                <option value="">-- S√©lectionner --</option>
                                <option value="opaque">Opaque</option>
                                <option value="transparent">Transparent</option>
                                <option value="inconnu">Inconnu</option>
                            </select>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">üßÆ Autres calcifications</label>
                        <textarea name="calcifications_autres" rows="2" class="input-field" placeholder="Calcifications vasculaires, ganglions, paroi v√©sicale..."></textarea>
                    </div>
                    
                    <div class="border-t border-gray-200 pt-4 mt-4">
                        <h4 class="text-md font-semibold text-gray-700 mb-3">Retentissement haut appareil</h4>
                        
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium mb-2">√âpaisseur cortex r√©nal (mm)</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <input type="number" step="0.1" name="epaisseur_cortex_renal_gauche" class="input-field" placeholder="Rein gauche">
                                    <input type="number" step="0.1" name="epaisseur_cortex_renal_droit" class="input-field" placeholder="Rein droit">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Diam√®tre py√©lon (mm)</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <input type="number" step="0.1" name="diametre_pyelon_gauche" class="input-field" placeholder="C√¥t√© gauche">
                                    <input type="number" step="0.1" name="diametre_pyelon_droit" class="input-field" placeholder="C√¥t√© droit">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Diam√®tre uret√®re en amont (mm)</label>
                                <div class="grid grid-cols-2 gap-4">
                                    <input type="number" step="0.1" name="diametre_uretere_amont_gauche" class="input-field" placeholder="C√¥t√© gauche">
                                    <input type="number" step="0.1" name="diametre_uretere_amont_droit" class="input-field" placeholder="C√¥t√© droit">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium mb-2">Malformations urinaires ou obstacles</label>
                                <select name="malformations_urinaires" class="input-field">
                                    <option value="">-- S√©lectionner --</option>
                                    <option value="Aucune">Aucune</option>
                                    <option value="Stenose JPU">St√©nose de la jonction py√©lo-ur√©t√©rale (JPU)</option>
                                    <option value="Syndrome JUV">Syndrome de la jonction ur√©t√©ro-v√©sicale</option>
                                    <option value="Megauretere">M√©gauret√®re</option>
                                    <option value="Reflux vesico-ureteral">Reflux v√©sico-ur√©t√©ral</option>
                                    <option value="Rein fer cheval">Rein en fer √† cheval</option>
                                    <option value="Ectopie renale">Ectopie r√©nale</option>
                                    <option value="Duplicite ureterale">Duplicit√© ur√©t√©rale</option>
                                    <option value="Ureterocele">Ur√©t√©roc√®le</option>
                                    <option value="Valve uretre posterieur">Valve de l'ur√®tre post√©rieur</option>
                                    <option value="Diverticule caliciel">Diverticule caliciel</option>
                                    <option value="Kyste renal">Kyste r√©nal</option>
                                    <option value="Polykystose renale">Polykystose r√©nale</option>
                                    <option value="Autre malformation">Autre malformation</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="hideNewImagingModal()" class="btn btn-secondary">Annuler</button>
                        <button type="submit" class="btn btn-primary">Cr√©er</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div id="newBiologyModal" class="hidden modal-backdrop">
        <div class="modal-content modal-md my-8 mx-4">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-xl font-bold text-gray-800">üß™ Nouvelle Biologie</h3>
            </div>
            <div class="p-6 max-h-[70vh] overflow-y-auto">
                <form id="newBiologyForm" class="space-y-4">
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-sm font-medium mb-2">üìÖ Date examen *</label>
                            <input type="date" name="date_examen" required class="input-field">
                        </div>
                        <div>
                            <label class="block text-sm font-medium mb-2">üß™ pH urinaire (4.5-8.5)</label>
                            <input type="number" name="ph_urinaire" step="0.1" min="4.5" max="8.5" class="input-field">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">üíß Densit√© urinaire</label>
                        <input type="number" name="densite_urinaire" step="0.001" min="1.000" max="1.040" placeholder="Ex: 1.020" class="input-field">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">üî¨ S√©diment urinaire</label>
                        <textarea name="sediment_urinaire" rows="2" class="input-field" placeholder="Cristaux, cylindres, cellules..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">ü¶† R√©sultats ECBU (Examen Cytobact√©riologique Urinaire)</label>
                        <textarea name="ecbu_resultats" rows="2" class="input-field" placeholder="Germe isol√© si infection..."></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">üìä Marqueurs m√©taboliques (valeurs num√©riques)</label>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">Oxalurie (mg/24h)</label>
                                <input type="number" name="oxalurie_valeur" step="0.1" class="input-field" placeholder="Ex: 40">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">Calciurie (mg/24h)</label>
                                <input type="number" name="calciurie_valeur" step="0.1" class="input-field" placeholder="Ex: 280">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">Calci√©mie (mmol/L)</label>
                                <input type="number" name="calciemie_valeur" step="0.01" class="input-field" placeholder="Ex: 2.5">
                            </div>
                        </div>
                        <p class="text-xs text-gray-500 mt-2">üí° Les marqueurs hyperoxalurie, hypercalciurie et hypercalc√©mie seront calcul√©s automatiquement</p>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">ü¶ã Hormones thyro√Ødiennes</label>
                        <div class="grid grid-cols-3 gap-4">
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">TSH (mUI/L)</label>
                                <input type="number" name="tsh" step="0.01" class="input-field" placeholder="Ex: 1.5">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">T3 (pg/mL)</label>
                                <input type="number" name="t3" step="0.1" class="input-field" placeholder="Ex: 1.8">
                            </div>
                            <div>
                                <label class="block text-xs text-gray-600 mb-1">T4 (ng/dL)</label>
                                <input type="number" name="t4" step="0.1" class="input-field" placeholder="Ex: 10.5">
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium mb-2">üìä Autres marqueurs</label>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="flex items-center">
                                <input type="checkbox" name="hyperuricurie" id="hyperuricurie" class="mr-2">
                                <label for="hyperuricurie">Hyperuricurie</label>
                            </div>
                            <div class="flex items-center">
                                <input type="checkbox" name="cystinurie" id="cystinurie" class="mr-2">
                                <label for="cystinurie">Cystinurie</label>
                            </div>
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        <div class="flex items-center">
                            <input type="checkbox" name="infection_urinaire" id="bio_infection" class="mr-2">
                            <label for="bio_infection">ü¶† Infection urinaire</label>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium mb-2">Germe √† ur√©ase identifi√©</label>
                            <select name="germe_urease" class="input-field">
                                <option value="">-- S√©lectionner --</option>
                                <option value="Aucun">Aucun</option>
                                <option value="Proteus mirabilis">Proteus mirabilis (ur√©ase +)</option>
                                <option value="Proteus vulgaris">Proteus vulgaris (ur√©ase +)</option>
                                <option value="Klebsiella pneumoniae">Klebsiella pneumoniae (ur√©ase +)</option>
                                <option value="Pseudomonas aeruginosa">Pseudomonas aeruginosa (ur√©ase +)</option>
                                <option value="Staphylococcus saprophyticus">Staphylococcus saprophyticus (ur√©ase +)</option>
                                <option value="Ureaplasma urealyticum">Ureaplasma urealyticum (ur√©ase +)</option>
                                <option value="Morganella morganii">Morganella morganii (ur√©ase +)</option>
                                <option value="Providencia rettgeri">Providencia rettgeri (ur√©ase +)</option>
                                <option value="Autre germe urease+">Autre germe √† ur√©ase</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="hideNewBiologyModal()" class="btn btn-secondary">Annuler</button>
                        <button type="submit" class="btn btn-primary">Cr√©er</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal: Modifier Patient -->
    <div id="editPatientModal" class="hidden modal-backdrop">
        <div class="modal-content modal-lg my-8 mx-4">
            <div class="p-6 border-b border-gray-200">
                <h3 class="text-2xl font-bold text-gray-800">‚úèÔ∏è Modifier le Patient</h3>
            </div>
            <div class="p-6 max-h-[70vh] overflow-y-auto">
                <form id="editPatientForm" class="space-y-6">
                    <!-- Informations personnelles -->
                    <div class="bg-blue-50 border-2 border-blue-200 rounded-lg p-4">
                        <h4 class="text-lg font-bold text-blue-900 mb-3">üë§ Informations personnelles</h4>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Nom *</label>
                                <input type="text" name="nom" id="edit_nom" required class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Pr√©nom *</label>
                                <input type="text" name="prenom" id="edit_prenom" required class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Date de naissance *</label>
                                <input type="date" name="date_naissance" id="edit_date_naissance" required class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Sexe *</label>
                                <select name="sexe" id="edit_sexe" required class="input-field">
                                    <option value="M">Masculin</option>
                                    <option value="F">F√©minin</option>
                                </select>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Groupe ethnique</label>
                                <input type="text" name="groupe_ethnique" id="edit_groupe_ethnique" class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">T√©l√©phone</label>
                                <input type="tel" name="telephone" id="edit_telephone" class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Email</label>
                                <input type="email" name="email" id="edit_email" class="input-field">
                            </div>
                            <div class="col-span-2">
                                <label class="block text-sm font-medium text-gray-700 mb-2">Adresse</label>
                                <textarea name="adresse" id="edit_adresse" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Poids (kg)</label>
                                <input type="number" name="poids" id="edit_poids" step="0.1" class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Taille (cm)</label>
                                <input type="number" name="taille" id="edit_taille" step="0.1" class="input-field">
                            </div>
                        </div>
                    </div>
                    
                    <!-- Ant√©c√©dents m√©dicaux -->
                    <div class="bg-green-50 border-2 border-green-200 rounded-lg p-4">
                        <h4 class="text-lg font-bold text-green-900 mb-3">üè• Ant√©c√©dents m√©dicaux</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ant√©c√©dents personnels</label>
                                <textarea name="antecedents_personnels" id="edit_antecedents_personnels" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ant√©c√©dents familiaux</label>
                                <textarea name="antecedents_familiaux" id="edit_antecedents_familiaux" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Ant√©c√©dents chirurgicaux</label>
                                <textarea name="antecedents_chirurgicaux" id="edit_antecedents_chirurgicaux" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Allergies</label>
                                <textarea name="allergies" id="edit_allergies" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Traitements chroniques</label>
                                <textarea name="traitements_chroniques" id="edit_traitements_chroniques" rows="2" class="input-field"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Hygi√®ne de vie et alimentation -->
                    <div class="bg-purple-50 border-2 border-purple-200 rounded-lg p-4">
                        <h4 class="text-lg font-bold text-purple-900 mb-3">üíß Hygi√®ne de vie</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Hydratation (L/jour)</label>
                                <input type="number" name="hydratation_jour" id="edit_hydratation_jour" step="0.1" class="input-field">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">R√©gime alimentaire</label>
                                <textarea name="regime_alimentaire" id="edit_regime_alimentaire" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Petit d√©jeuner</label>
                                <textarea name="petit_dejeuner" id="edit_petit_dejeuner" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">D√©jeuner</label>
                                <textarea name="dejeuner" id="edit_dejeuner" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">D√Æner</label>
                                <textarea name="diner" id="edit_diner" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Grignotage</label>
                                <textarea name="grignotage" id="edit_grignotage" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Autres consommations</label>
                                <textarea name="autres_consommations" id="edit_autres_consommations" rows="2" class="input-field"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Donn√©es m√©dicales suppl√©mentaires -->
                    <div class="bg-yellow-50 border-2 border-yellow-200 rounded-lg p-4">
                        <h4 class="text-lg font-bold text-yellow-900 mb-3">üìã Donn√©es m√©dicales</h4>
                        <div class="space-y-3">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">R√©sultats ASP</label>
                                <textarea name="asp_resultats" id="edit_asp_resultats" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">R√©sultats √©chographie</label>
                                <textarea name="echographie_resultats" id="edit_echographie_resultats" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">R√©sultats uro-scanner</label>
                                <textarea name="uroscanner_resultats" id="edit_uroscanner_resultats" rows="2" class="input-field"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Nombre de calculs</label>
                                    <input type="number" name="nombre_calculs" id="edit_nombre_calculs" class="input-field">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Topographie</label>
                                    <input type="text" name="topographie_calcul" id="edit_topographie_calcul" list="topographie_suggestions" class="input-field">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Diam√®tre longitudinal (mm)</label>
                                    <input type="number" name="diametre_longitudinal" id="edit_diametre_longitudinal" step="0.1" class="input-field">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Diam√®tre transversal (mm)</label>
                                    <input type="number" name="diametre_transversal" id="edit_diametre_transversal" step="0.1" class="input-field">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Forme du calcul</label>
                                    <select name="forme_calcul" id="edit_forme_calcul" class="input-field">
                                        <option value="">-- S√©lectionner --</option>
                                        <option value="Arrondie">Arrondie</option>
                                        <option value="Ovale">Ovale</option>
                                        <option value="Irreguliere">Irr√©guli√®re</option>
                                        <option value="Coralliforme">Coralliforme</option>
                                        <option value="Spiculee">Spicul√©e</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Contour du calcul</label>
                                    <select name="contour_calcul" id="edit_contour_calcul" class="input-field">
                                        <option value="">-- S√©lectionner --</option>
                                        <option value="Lisse">Lisse</option>
                                        <option value="Irregulier">Irr√©gulier</option>
                                        <option value="Spicule">Spicul√©</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Densit√© noyau (UH)</label>
                                    <input type="number" name="densite_noyau" id="edit_densite_noyau" class="input-field">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Densit√©s couches</label>
                                    <input type="text" name="densites_couches" id="edit_densites_couches" class="input-field">
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">Autres calcifications</label>
                                <textarea name="calcifications_autres" id="edit_calcifications_autres" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">S√©diment urinaire</label>
                                <textarea name="sediment_urinaire" id="edit_sediment_urinaire" rows="2" class="input-field"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">R√©sultats ECBU</label>
                                <textarea name="ecbu_resultats" id="edit_ecbu_resultats" rows="2" class="input-field"></textarea>
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">pH urinaire</label>
                                    <input type="number" name="ph_urinaire" id="edit_ph_urinaire" step="0.1" class="input-field">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-2">Densit√© urinaire</label>
                                    <input type="number" name="densite_urinaire" id="edit_densite_urinaire" step="0.001" class="input-field">
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Notes -->
                    <div class="bg-gray-50 border-2 border-gray-200 rounded-lg p-4">
                        <h4 class="text-lg font-bold text-gray-900 mb-3">üìù Notes</h4>
                        <textarea name="notes" id="edit_notes" rows="3" class="input-field"></textarea>
                    </div>
                    
                    <div class="flex justify-end space-x-3 pt-4">
                        <button type="button" onclick="hideEditPatientModal()" class="btn btn-secondary">Annuler</button>
                        <button type="submit" class="btn btn-primary">üíæ Enregistrer</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <!-- Modal: Confirmation Suppression -->
    <div id="deleteConfirmModal" class="hidden modal-backdrop">
        <div class="modal-content modal-sm my-8 mx-4">
            <div class="p-6 border-b border-gray-200 bg-red-50">
                <h3 class="text-2xl font-bold text-red-800">‚ö†Ô∏è Confirmer la suppression</h3>
            </div>
            <div class="p-6">
                <p class="text-gray-700 mb-4">√ätes-vous s√ªr de vouloir supprimer ce patient ?</p>
                <p class="text-red-600 font-semibold mb-4">‚ö†Ô∏è Cette action est irr√©versible !</p>
                <p class="text-gray-600 text-sm mb-6">Toutes les donn√©es du patient, incluant les √©pisodes, imageries et biologies seront d√©finitivement supprim√©es.</p>
                
                <div class="flex justify-end space-x-3">
                    <button type="button" onclick="hideDeleteConfirmModal()" class="btn btn-secondary">Annuler</button>
                    <button type="button" onclick="deletePatient()" class="btn bg-red-600 hover:bg-red-700 text-white">üóëÔ∏è Supprimer d√©finitivement</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        window.patientId = {{ patient_id }};
    </script>
    <script src="/static/js/csrf.js"></script>
    <script src="/static/js/patient.js"></script>
</body>
</html>
